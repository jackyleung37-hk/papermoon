<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport"/>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    
    <title>ÈÇäÂÄãÊäµË≤∑Âï≤Ôºü- Ë∂ÖÂ∑øÊ†ºÂÉπË®àÁÆóÊ©ü</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto-Sans+TC:wght@700;900&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
    <script id="tailwind-config">
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        "sweet-pink": "#ff8fa3",
                        "sweet-pink-dark": "#ff4d6d",
                        "ui-dark": "#334155",
                        "item-bg": "#ffffff"
                    }
                }
            }
        }
    </script>
    <style>
        .material-symbols-rounded { font-variation-settings: "FILL" 1, "wght" 700, "GRAD" 0, "opsz" 24 }
        
        body { 
            font-family: 'Noto Sans TC', sans-serif; 
            background-color: #fffaf0; 
            overflow: hidden; 
            height: 100vh;
            height: -webkit-fill-available;
            display: flex;
            flex-direction: column;
            margin: 0;
        }

        html { height: -webkit-fill-available; }
        
        .compact-input {
            border: 3px solid #ffccd5 !important;
            background-color: #ffffff !important;
            color: #000000 !important;
            font-size: 1.25rem !important;
            font-weight: 800 !important;
            border-radius: 18px !important;
            padding: 0.5rem !important;
            text-align: center;
        }

        .winner-glow {
            border: 4px solid #ff4d6d !important;
            background-color: #fff0f3 !important;
            box-shadow: 0 0 15px rgba(255, 77, 109, 0.4);
            animation: bounce 0.5s ease infinite alternate;
        }

        @keyframes bounce {
            from { transform: translateY(0); }
            to { transform: translateY(-4px); }
        }

        #scroll-area {
            flex: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding: 1rem;
            transition: all 0.3s ease;
        }

        footer {
            padding-bottom: calc(env(safe-area-inset-bottom, 0px) + 1rem);
            background: white;
            transition: all 0.3s ease;
        }

        .helper-bubble {
            position: relative;
            background: #ff8fa3;
            color: white;
            border-radius: 20px;
            padding: 12px 20px;
            font-weight: 900;
            display: inline-block;
            box-shadow: 0 4px 15px rgba(255, 143, 163, 0.2);
        }
        .helper-bubble::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            border-width: 10px 10px 0;
            border-style: solid;
            border-color: #ff8fa3 transparent transparent;
        }

        #guide-zone.hide {
            display: none;
        }

        /* ÁßªÈô§ÊñúÈ´î‰∏¶Á®çÂæÆÂä†Â§ßÊ®ôÁ±§Â≠óÈ´î */
        .input-label {
            display: block;
            font-size: 0.75rem; /* text-xs */
            font-weight: 900;
            color: #ec4899; /* pink-500 */
            margin-bottom: 0.25rem;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: -0.025em;
        }
    </style>
</head>
<body class="text-slate-800">

<header class="bg-white border-b-4 border-pink-100 px-4 shadow-sm shrink-0 z-10 pt-[calc(env(safe-area-inset-top,0px)+12px)] pb-3">
    <div class="max-w-md mx-auto flex items-center justify-between">
        <div>
            <h1 id="lang-title" class="text-xl font-black text-sweet-pink-dark flex items-center gap-2">
                <span class="material-symbols-rounded fill-1">calculate</span>ÈÇäÂÄãÊäµË≤∑Âï≤Ôºü
            </h1>
            <p id="lang-sub" class="text-xs font-black text-slate-400 tracking-wider">Ë∂ÖÂ∏ÇÊ†ºÂÉπË®àÁÆóÊ©ü</p>
        </div>
        <button id="lang-btn" onclick="toggleLang()" class="bg-blue-500 text-white px-3 py-1 rounded-xl text-xs font-black shadow-md flex items-center gap-1">
            <span class="material-symbols-rounded text-xs">translate</span>EN
        </button>
    </div>
</header>

<main id="scroll-area">
    <div id="item-list" class="max-w-md mx-auto space-y-3 pb-4"></div>
</main>

<footer class="bg-white border-t-8 border-pink-50 p-4 shadow-[0_-10px_30px_rgba(0,0,0,0.05)] shrink-0 z-10">
    <div class="max-w-md mx-auto space-y-3">
        <div id="guide-zone" class="text-center mb-2">
            <div id="helper-bubble" class="helper-bubble">Ë´ãËº∏ÂÖ•Á¨¨‰∏Ä‰ª∂ÂïÜÂìÅ ‚ú®</div>
        </div>

        <div class="grid grid-cols-12 gap-2 bg-pink-50 p-3 rounded-[24px] border-2 border-pink-100">
            <div class="col-span-4">
                <label id="lbl-price" class="input-label">ÂÉπÈå¢ ($)</label>
                <input type="number" id="input-p" placeholder="0" class="compact-input w-full outline-none py-1 text-lg">
            </div>
            <div class="col-span-4">
                <label id="lbl-qty" class="input-label">Êï∏Èáè/ÈáçÈáè</label>
                <input type="number" id="input-q" placeholder="0" class="compact-input w-full outline-none py-1 text-lg">
            </div>
            <div class="col-span-4">
                <label id="lbl-unit" class="input-label">ÂñÆ‰Ωç</label>
                <select id="input-u" class="compact-input w-full outline-none py-1 text-base appearance-none"></select>
            </div>
        </div>

        <div id="btn-container" class="flex gap-2"></div>
        <div id="clear-container"></div>
    </div>
</footer>

<script>
    let items = [];
    let currentLang = 'zh';

    const translations = {
        zh: { 
            title: "ÈÇäÂÄãÊäµË≤∑Âï≤Ôºü", sub: "Ë∂ÖÂ∏ÇÊ†ºÂÉπË®àÁÆóÊ©ü", add: "Âä†‰∏Ä‰ª∂", compare: "Á´ãÂç≥Ê†ºÂÉπ", clear: "Ê∏ÖÈô§ÂÖßÂÆπ", 
            winning: "ÊúÄÊäµË≤∑ÔºÅ", per: "ÊØè", itemLabel: "ÂïÜÂìÅ", empty: "Ê∫ñÂÇôÂ•ΩÊ†ºÂÉπÊú™Ôºü",
            guide1: "Ë´ãËº∏ÂÖ•Á¨¨‰∏Ä‰ª∂ÂïÜÂìÅ ‚ú®", guide2: "Â•ΩÔºÅÂÜçÂä†Â§ö‰∏Ä‰ª∂ÊØîÊØîÁúã ‚öñÔ∏è",
            price: "ÂÉπÈå¢ ($)", qty: "Êï∏Èáè/ÈáçÈáè", unit: "ÂñÆ‰Ωç", langBtn: "EN",
            units: [
                { val: 1, type: "weight", text: "ÂÖã g" }, { val: 1000, type: "weight", text: "ÂÖ¨Êñ§ kg" },
                { val: 1, type: "liquid", text: "ÊØ´Âçá ml" }, { val: 1000, type: "liquid", text: "Âçá L" },
                { val: 1, type: "piece", text: "ÂÄã pcs" }
            ]
        },
        en: { 
            title: "Which is Cheaper?", sub: "Price Calculator", add: "Add Item", compare: "Compare!", clear: "Clear All", 
            winning: "Winner!", per: "per", itemLabel: "Item", empty: "Ready to calc?",
            guide1: "Enter 1st item price ‚ú®", guide2: "Great! Add one more ‚öñÔ∏è",
            price: "Price ($)", qty: "Qty/Weight", unit: "Unit", langBtn: "‰∏≠",
            units: [
                { val: 1, type: "weight", text: "g" }, { val: 1000, type: "weight", text: "kg" },
                { val: 1, type: "ml", text: "ml" }, { val: 1000, type: "L", text: "L" },
                { val: 1, type: "piece", text: "pcs" }
            ]
        }
    };

    function updateUnitSelect() {
        const uSel = document.getElementById('input-u');
        uSel.innerHTML = translations[currentLang].units.map(u => 
            `<option value="${u.val}" data-type="${u.type}">${u.text}</option>`
        ).join('');
    }

    function toggleLang() {
        currentLang = currentLang === 'zh' ? 'en' : 'zh';
        const t = translations[currentLang];
        
        document.getElementById('lang-title').innerHTML = `<span class="material-symbols-rounded">calculate</span>` + t.title;
        document.getElementById('lang-sub').innerText = t.sub;
        document.getElementById('lang-btn').innerHTML = `<span class="material-symbols-rounded text-xs">translate</span>` + t.langBtn;
        
        document.getElementById('lbl-price').innerText = t.price;
        document.getElementById('lbl-qty').innerText = t.qty;
        document.getElementById('lbl-unit').innerText = t.unit;

        updateUnitSelect();
        renderList();
    }

    function addNewItem() {
        const pInput = document.getElementById('input-p');
        const qInput = document.getElementById('input-q');
        const uSel = document.getElementById('input-u');
        const p = parseFloat(pInput.value);
        const q = parseFloat(qInput.value);
        if (isNaN(p) || isNaN(q) || p <= 0 || q <= 0) return;

        const u = parseFloat(uSel.value);
        const type = uSel.options[uSel.selectedIndex].getAttribute('data-type');
        const unitLabel = uSel.options[uSel.selectedIndex].text;
        
        const isSmallUnit = (type === 'weight' && u === 1) || (type === 'liquid' && u === 1);
        const finalPrice = (p / (q * u)) * (isSmallUnit ? 100 : 1);

        items.push({ p, q, unitLabel, type, finalPrice, id: Date.now(), pureUnit: unitLabel.split(' ').pop(), isSmallUnit });
        pInput.value = ''; qInput.value = '';
        renderList();
        
        const scrollArea = document.getElementById('scroll-area');
        scrollArea.scrollTop = scrollArea.scrollHeight;
    }

    function renderList(winnerId = null) {
        const listContainer = document.getElementById('item-list');
        const btnContainer = document.getElementById('btn-container');
        const clearContainer = document.getElementById('clear-container');
        const helper = document.getElementById('helper-bubble');
        const guideZone = document.getElementById('guide-zone');
        const t = translations[currentLang];

        if (items.length === 0) {
            guideZone.classList.remove('hide');
            helper.innerText = t.guide1;
            listContainer.innerHTML = `<div class="text-center py-16 text-slate-200 opacity-50"><span class="material-symbols-rounded text-8xl block mb-2">balance</span><p class="font-bold">${t.empty}</p></div>`;
        } else if (items.length === 1) {
            guideZone.classList.remove('hide');
            helper.innerText = t.guide2;
        } else {
            guideZone.classList.add('hide');
        }

        if (items.length > 0) {
            listContainer.innerHTML = '';
            items.forEach((item, index) => {
                const isWinner = item.id === winnerId;
                const baseVal = item.isSmallUnit ? "100" : "1";
                const suffix = `${t.per} ${baseVal}${item.pureUnit}`;

                listContainer.insertAdjacentHTML('beforeend', `
                    <div class="flex items-center justify-between bg-white p-4 rounded-3xl border-4 ${isWinner ? 'winner-glow' : 'border-pink-50'} shadow-sm transition-all">
                        <div class="flex items-center gap-4">
                            <div class="bg-slate-800 text-white w-8 h-8 flex items-center justify-center rounded-xl font-black text-sm shrink-0 shadow-sm">${index + 1}</div>
                            <div>
                                <p class="text-lg font-black text-slate-700">$${item.p} <span class="text-xs font-bold text-slate-400">/ ${item.q}${item.pureUnit}</span></p>
                            </div>
                        </div>
                        <div class="text-right">
                            ${isWinner ? `<p class="text-[10px] font-black text-sweet-pink-dark">üéâ ${t.winning}</p>` : ''}
                            <p class="text-2xl font-black ${isWinner ? 'text-sweet-pink-dark' : 'text-slate-700'}">$${item.finalPrice.toFixed(2)}</p>
                            <p class="text-[10px] font-bold text-slate-300 italic">${suffix}</p>
                        </div>
                    </div>`);
            });
        }

        btnContainer.innerHTML = `<button onclick="addNewItem()" class="flex-1 h-14 rounded-[20px] bg-slate-800 text-white font-black text-base flex items-center justify-center gap-1 active:bg-slate-700 transition-all shadow-md"><span>${t.add}</span></button>`;
        if (items.length >= 2) {
            btnContainer.innerHTML += `<button onclick="compareAll()" class="flex-[1.5] h-14 rounded-[20px] bg-sweet-pink text-white font-black text-xl shadow-[0_4px_0_0_#ff4d6d] active:shadow-none active:translate-y-1 transition-all flex items-center justify-center gap-2"><span>${t.compare}</span></button>`;
        }

        clearContainer.innerHTML = items.length >= 1 ? `<button onclick="clearAll()" class="w-full h-10 mt-2 bg-slate-200 text-slate-600 rounded-xl font-black text-xs uppercase tracking-widest active:bg-slate-300 transition-all">${t.clear}</button>` : '';
    }

    function compareAll() {
        if (items.length < 2) return;
        const minPrice = Math.min(...items.map(i => i.finalPrice));
        renderList(items.find(i => i.finalPrice === minPrice).id);
    }

    function clearAll() { items = []; renderList(); }
    updateUnitSelect();
    renderList();
</script>
</body>
</html>

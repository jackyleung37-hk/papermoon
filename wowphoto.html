<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>攝影景點搜尋</title>
  <!-- Firebase JS SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
  <style>
    body {
      font-family: "Segoe UI", Arial, sans-serif;
      background-color: #f7f8fa;
      margin: 0;
      padding: 0;
      color: #333;
    }
    .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
    h1 { text-align: center; color: #2c3e50; margin: 20px 0; font-size: 2.5em; }

    /* Carousel */
    .carousel { position: relative; height: 400px; overflow: hidden; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    .carousel-inner { display: flex; transition: transform 0.5s ease; height: 100%; }
    .carousel-item { flex: 0 0 100%; position: relative; }
    .carousel-item img { width: 100%; height: 100%; object-fit: cover; filter: brightness(70%); }
    .carousel-caption { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); text-align: center; color: #fff; text-shadow: 0 2px 4px rgba(0,0,0,0.6); }
    .carousel-caption h2 { font-size: 2em; margin: 0; }
    .carousel-caption p { font-size: 1.2em; margin: 5px 0 0; }
    .carousel-prev, .carousel-next { position: absolute; top: 50%; transform: translateY(-50%); background: rgba(0,0,0,0.5); color: #fff; border: none; padding: 10px; cursor: pointer; font-size: 1.5em; z-index: 10; }
    .carousel-prev { left: 10px; }
    .carousel-next { right: 10px; }
    .carousel-dots { position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%); display: flex; gap: 8px; }
    .dot { width: 12px; height: 12px; background: #bbb; border-radius: 50%; cursor: pointer; }
    .dot.active { background: #fff; }

    /* Locations Grid */
    .locations-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-top: 40px; }
    .location-card { background: #fff; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); overflow: hidden; transition: transform 0.3s; }
    .location-card:hover { transform: translateY(-5px); }
    .location-card img { width: 100%; height: 180px; object-fit: cover; border-bottom: 1px solid #eee; }
    .location-info { padding: 15px; }
    .location-info h3 { font-size: 1.4em; margin: 0 0 10px; color: #2c3e50; }
    .location-info p { font-size: 0.95em; margin: 5px 0; color: #555; }
    .location-info a { color: #2196F3; text-decoration: none; display: inline-block; margin-top: 10px; }
    .location-info a:hover { text-decoration: underline; }

    /* Pagination */
    .pagination { text-align: center; margin-top: 30px; }
    .pagination button { padding: 8px 12px; margin: 0 5px; border: none; background: #eee; border-radius: 4px; cursor: pointer; }
    .pagination button.active { background: #2196F3; color: #fff; }
    .pagination button:hover { background: #ddd; }

    /* Status */
    #status { text-align: center; margin-top: 20px; color: #666; }
  </style>
</head>
<body>
  <div class="container">
    <h1>攝影景點搜尋</h1>

    <!-- Carousel Banner for Popular Locations -->
    <div class="carousel">
      <div class="carousel-inner" id="carouselInner"></div>
      <button class="carousel-prev" onclick="prevSlide()">&#10094;</button>
      <button class="carousel-next" onclick="nextSlide()">&#10095;</button>
      <div class="carousel-dots" id="carouselDots"></div>
    </div>

    <!-- Locations Grid -->
    <div class="locations-grid" id="locationsGrid"></div>

    <!-- Pagination -->
    <div class="pagination" id="pagination"></div>

    <div id="status"></div>
  </div>

  <script>
    // Firebase 配置
    const firebaseConfig = {
      apiKey: "AIzaSyAXTlWcavjoa98iaiguoXx0MRyQ19B1Tns",
      authDomain: "myapp-test37.firebaseapp.com",
      databaseURL: "https://myapp-test37-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "myapp-test37",
      storageBucket: "myapp-test37.firebasestorage.app",
      messagingSenderId: "1012430533501",
      appId: "1:1012430533501:web:4a6be66b2c39b219149214"
    };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    const locationsRef = database.ref('locations');

    let allLocations = [];
    let popularLocations = [];
    let currentPage = 2; // 初始第 2 頁
    const itemsPerPage = 10;
    let currentSlide = 0;

    // 載入所有資料
    locationsRef.once('value').then(snap => {
      const data = snap.val();
      if (!data) {
        document.getElementById('locationsGrid').innerHTML = '<p>無景點資料</p>';
        document.getElementById('status').textContent = '無景點資料';
        return;
      }

      allLocations = Object.entries(data).map(([id, loc]) => ({ id, ...loc }));

      // 過濾熱門景點 (tags 包含 "popular")
      popularLocations = allLocations.filter(loc => loc.tags && loc.tags.includes('popular'));
      if (popularLocations.length === 0) {
        document.getElementById('carouselInner').innerHTML = '<div class="carousel-item"><div class="carousel-caption"><h2>暫無熱門景點</h2></div></div>';
      } else {
        renderCarousel();
        autoSlide();
      }

      // 檢查是否有足夠資料跳到第 2 頁
      const totalPages = Math.ceil(allLocations.length / itemsPerPage);
      if (totalPages < 2) currentPage = 1; // 若少於 2 頁，顯示第 1 頁
      renderGrid(currentPage);
      renderPagination();
    }).catch(e => document.getElementById('status').textContent = '載入錯誤：' + e.message);

    // 渲染 Carousel
    function renderCarousel() {
      const inner = document.getElementById('carouselInner');
      const dots = document.getElementById('carouselDots');
      inner.innerHTML = '';
      dots.innerHTML = '';
      popularLocations.forEach((loc, index) => {
        inner.innerHTML += `
          <div class="carousel-item">
            <img src="${loc.imageUrl || 'https://via.placeholder.com/1200x400?text=無圖片'}" alt="${loc.name}">
            <div class="carousel-caption">
              <h2>${loc.name}</h2>
              <p>${loc.types.map(t => ({sunset: '日落', sunrise: '日出', night_view: '夜景', starry_sky: '星空'}[t] || t)).join(', ')}</p>
            </div>
          </div>`;
        const dot = document.createElement('div');
        dot.className = 'dot';
        dot.onclick = () => showSlide(index);
        dots.appendChild(dot);
      });
      showSlide(currentSlide);
    }

    // Carousel 切換
    function showSlide(index) {
      const items = document.querySelectorAll('.carousel-item');
      const dots = document.querySelectorAll('.dot');
      if (index >= items.length) index = 0;
      if (index < 0) index = items.length - 1;
      currentSlide = index;
      document.getElementById('carouselInner').style.transform = `translateX(-${index * 100}%)`;
      dots.forEach(d => d.classList.remove('active'));
      dots[index].classList.add('active');
    }

    function nextSlide() { showSlide(currentSlide + 1); }
    function prevSlide() { showSlide(currentSlide - 1); }
    function autoSlide() { setInterval(nextSlide, 5000); }

    // 渲染景點 Grid
    function renderGrid(page) {
      const grid = document.getElementById('locationsGrid');
      grid.innerHTML = '';
      const start = (page - 1) * itemsPerPage;
      const end = start + itemsPerPage;
      const paginated = allLocations.slice(start, end);
      paginated.forEach(loc => {
        const card = document.createElement('div');
        card.className = 'location-card';
        card.innerHTML = `
          <img src="${loc.imageUrl || 'https://via.placeholder.com/280x180?text=無圖片'}" alt="${loc.name}">
          <div class="location-info">
            <h3>${loc.name || '無名稱'}</h3>
            <p><strong>月份：</strong>${loc.months.map(m => ({January: '一月', February: '二月', March: '三月', April: '四月', May: '五月', June: '六月', July: '七月', August: '八月', September: '九月', October: '十月', November: '十一月', December: '十二月'}[m] || m)).join(', ')}</p>
            <p><strong>類型：</strong>${loc.types.map(t => ({sunset: '日落', sunrise: '日出', night_view: '夜景', starry_sky: '星空'}[t] || t)).join(', ')}</p>
            <p><strong>最佳時間：</strong>${loc.bestTime || '無'}</p>
            <p><strong>難度：</strong>${loc.difficulty ? {Easy: '簡單', Medium: '中等', Hard: '困難'}[loc.difficulty] || loc.difficulty : '無'}</p>
            <p><strong>攝影提示：</strong>${loc.tips || '無'}</p>
            <p><strong>天氣條件：</strong>${loc.weather || '無'}</p>
            <p><strong>標籤：</strong>${loc.tags.map(tag => ({mountain: '山景', sea: '海景', city: '城市', hidden_spot: '隱秘地點', popular: '熱門'}[tag] || tag)).join(', ')}</p>
            <a href="${loc.mapPin}" target="_blank">查看地圖</a>
          </div>
        `;
        grid.appendChild(card);
      });
    }

    // 渲染分頁
    function renderPagination() {
      const pagination = document.getElementById('pagination');
      pagination.innerHTML = '';
      const totalPages = Math.ceil(allLocations.length / itemsPerPage);
      for (let i = 1; i <= totalPages; i++) {
        const btn = document.createElement('button');
        btn.textContent = i;
        btn.onclick = () => {
          currentPage = i;
          renderGrid(currentPage);
          document.querySelectorAll('.pagination button').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
        };
        if (i === currentPage) btn.classList.add('active');
        pagination.appendChild(btn);
      }
    }
  </script>
</body>
</html>

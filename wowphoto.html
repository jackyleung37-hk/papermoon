<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase CMS UI</title>
    <!-- Firebase JS SDK (v9.6.0 相容模式) -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f4f4f9;
            display: flex;
            justify-content: center;
        }
        .container {
            padding: 20px;
            width: 600px;
            max-width: 100%;
        }
        .form-container {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        h1 { text-align: center; color: #333; }
        input, select {
            width: 100%;
            padding: 8px;
            margin: 5px 0 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            padding: 8px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            color: white;
        }
        #saveBtn { background: #4CAF50; width: 100%; }
        #saveBtn:hover { background: #45a049; }
        #loginBtn { background: #2196F3; width: 100%; }
        #loginBtn:hover { background: #1e88e5; }
        #output { margin-top: 20px; }
        #status { color: #888; text-align: center; margin-top: 10px; }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th { background-color: #f2f2f2; }
        .action-btn {
            padding: 5px;
            margin: 2px;
            cursor: pointer;
        }
        .edit-btn { background: #FFA000; color: white; }
        .delete-btn { background: #f44336; color: white; }
        #loginContainer { display: block; }
        #cmsContainer { display: none; }
    </style>
</head>
<body>
    <div class="container" id="loginContainer">
        <div class="form-container">
            <h1>CMS Login</h1>
            <input type="password" id="passwordInput" placeholder="Enter password...">
            <button id="loginBtn" onclick="login()">Login</button>
            <div id="status"></div>
        </div>
    </div>

    <div class="container" id="cmsContainer">
        <h1>CMS UI - Add/Edit Location</h1>
        <div class="form-container">
            <select id="monthSelect">
                <option value="">Select Month</option>
                <option value="January">January</option>
                <option value="February">February</option>
                <option value="March">March</option>
                <option value="April">April</option>
                <option value="May">May</option>
                <option value="June">June</option>
                <option value="July">July</option>
                <option value="August">August</option>
                <option value="September">September</option>
                <option value="October">October</option>
                <option value="November">November</option>
                <option value="December">December</option>
            </select>
            <input type="url" id="urlInput" placeholder="Enter URL...">
            <input type="date" id="shootingDateInput" placeholder="Shooting Date">
            <select id="locationSelect">
                <option value="">Select Location (Mountain/City)</option>
                <option value="Hong Kong Island">Hong Kong Island</option>
                <option value="Kowloon">Kowloon</option>
                <option value="New Territories">New Territories</option>
                <option value="Lantau Island">Lantau Island</option>
                <option value="Tai Mo Shan">Tai Mo Shan</option>
            </select>
            <select id="typeSelect">
                <option value="">Select Type</option>
                <option value="sunset">Sunset</option>
                <option value="sunrise">Sunrise</option>
                <option value="night_view">Night View</option>
                <option value="starry_sky">Starry Sky</option>
            </select>
            <input type="url" id="mapPinInput" placeholder="Enter Google Map Pin URL...">
            <button id="saveBtn" onclick="saveLocation()">Save Location</button>
        </div>

        <h2>Locations Table</h2>
        <table id="locationsTable">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Month</th>
                    <th>URL</th>
                    <th>Shooting Date</th>
                    <th>Location</th>
                    <th>Type</th>
                    <th>Map Pin</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        <div id="status"></div>
    </div>

    <script>
        // Firebase 配置
        const firebaseConfig = {
            apiKey: "AIzaSyAXTlWcavjoa98iaiguoXx0MRyQ19B1Tns",
            authDomain: "myapp-test37.firebaseapp.com",
            databaseURL: "https://myapp-test37-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "myapp-test37",
            storageBucket: "myapp-test37.firebasestorage.app",
            messagingSenderId: "1012430533501",
            appId: "1:1012430533501:web:4a6be66b2c39b219149214",
            measurementId: "G-GJVS2NNGF2"
        };

        // 初始化 Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const locationsRef = database.ref('locations');

        let editingId = null; // 用來追蹤是否在編輯模式

        // 密碼驗證
        function login() {
            const password = document.getElementById('passwordInput').value;
            if (password === 'cms1984') {
                document.getElementById('loginContainer').style.display = 'none';
                document.getElementById('cmsContainer').style.display = 'block';
                loadTable(); // 登入後載入表格
            } else {
                showStatus('Incorrect password!', true);
            }
        }

        // 保存位置 (新增或更新)
        function saveLocation() {
            const month = document.getElementById('monthSelect').value;
            const url = document.getElementById('urlInput').value.trim();
            const shootingDate = document.getElementById('shootingDateInput').value;
            const location = document.getElementById('locationSelect').value;
            const type = document.getElementById('typeSelect').value;
            const mapPin = document.getElementById('mapPinInput').value.trim();

            if (!month || !url || !shootingDate || !location || !type || !mapPin) {
                showStatus('Please fill all fields!', true);
                return;
            }

            const locationData = {
                month: month,
                url: url,
                shooting_date: shootingDate,
                location: location,
                type: type,
                map_pin: mapPin
            };

            let ref;
            if (editingId) {
                // 更新模式
                ref = locationsRef.child(editingId);
                ref.update(locationData)
                    .then(() => {
                        showStatus('Location updated successfully!');
                        resetForm();
                        loadTable();
                    })
                    .catch((error) => {
                        console.error('Update failed:', error);
                        showStatus('Error updating location: ' + error.message, true);
                    });
            } else {
                // 新增模式
                ref = locationsRef.push();
                locationData.id = ref.key;
                ref.set(locationData)
                    .then(() => {
                        showStatus('Location added successfully!');
                        resetForm();
                        loadTable();
                    })
                    .catch((error) => {
                        console.error('Add failed:', error);
                        showStatus('Error adding location: ' + error.message, true);
                    });
            }
        }

        // 載入表格
        function loadTable() {
            locationsRef.once('value')
                .then((snapshot) => {
                    const tbody = document.querySelector('#locationsTable tbody');
                    tbody.innerHTML = '';
                    const data = snapshot.val();
                    if (data) {
                        for (let key in data) {
                            const loc = data[key];
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>${key}</td>
                                <td>${loc.month}</td>
                                <td><a href="${loc.url}" target="_blank">Link</a></td>
                                <td>${loc.shooting_date}</td>
                                <td>${loc.location}</td>
                                <td>${loc.type}</td>
                                <td><a href="${loc.map_pin}" target="_blank">Link</a></td>
                                <td>
                                    <button class="action-btn edit-btn" onclick="editLocation('${key}')">Edit</button>
                                    <button class="action-btn delete-btn" onclick="deleteLocation('${key}')">Delete</button>
                                </td>
                            `;
                            tbody.appendChild(row);
                        }
                    } else {
                        tbody.innerHTML = '<tr><td colspan="8">No locations found.</td></tr>';
                    }
                })
                .catch((error) => {
                    console.error('Error loading table:', error);
                    showStatus('Error loading locations: ' + error.message, true);
                });
        }

        // 編輯位置
        function editLocation(id) {
            locationsRef.child(id).once('value')
                .then((snapshot) => {
                    const loc = snapshot.val();
                    if (loc) {
                        document.getElementById('monthSelect').value = loc.month;
                        document.getElementById('urlInput').value = loc.url;
                        document.getElementById('shootingDateInput').value = loc.shooting_date;
                        document.getElementById('locationSelect').value = loc.location;
                        document.getElementById('typeSelect').value = loc.type;
                        document.getElementById('mapPinInput').value = loc.map_pin;
                        editingId = id;
                        showStatus('Editing location: ' + id);
                    }
                })
                .catch((error) => {
                    console.error('Error fetching for edit:', error);
                    showStatus('Error: ' + error.message, true);
                });
        }

        // 刪除位置
        function deleteLocation(id) {
            if (confirm('Are you sure you want to delete this location?')) {
                locationsRef.child(id).remove()
                    .then(() => {
                        showStatus('Location deleted successfully!');
                        loadTable();
                    })
                    .catch((error) => {
                        console.error('Delete failed:', error);
                        showStatus('Error deleting location: ' + error.message, true);
                    });
            }
        }

        // 重置表單
        function resetForm() {
            document.getElementById('monthSelect').value = '';
            document.getElementById('urlInput').value = '';
            document.getElementById('shootingDateInput').value = '';
            document.getElementById('locationSelect').value = '';
            document.getElementById('typeSelect').value = '';
            document.getElementById('mapPinInput').value = '';
            editingId = null;
        }

        // 顯示狀態訊息
        function showStatus(message, isError = false) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.style.color = isError ? 'red' : 'green';
            setTimeout(() => status.textContent = '', 3000);
        }
    </script>
</body>
</html>

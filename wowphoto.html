<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Firebase CMS UI</title>
<script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>

<style>
body {
    font-family: Arial, sans-serif;
    background-color: #f4f4f9;
    margin: 0;
    padding: 20px;
    display: flex;
    justify-content: center;
}
.container {
    width: 700px;
    max-width: 100%;
}
h1, h2 {
    text-align: center;
    color: #333;
    margin: 10px 0;
}
.form-container {
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    padding: 15px;
}
.form-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
}
input, select {
    width: 100%;
    padding: 6px 8px;
    border: 1px solid #ccc;
    border-radius: 4px;
    box-sizing: border-box;
}
button {
    padding: 8px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    color: #fff;
    width: 100%;
}
#loginBtn { background: #2196F3; }
#loginBtn:hover { background: #1e88e5; }
#saveBtn { background: #4CAF50; }
#saveBtn:hover { background: #45a049; }
#logoutBtn { background: #f44336; }
#logoutBtn:hover { background: #d32f2f; }
.button-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    margin-top: 10px;
}
table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
}
th, td {
    border: 1px solid #ddd;
    padding: 6px 8px;
    text-align: left;
    font-size: 14px;
}
th {
    background-color: #f2f2f2;
}
.action-btn {
    padding: 5px 8px;
    border-radius: 4px;
    color: #fff;
    border: none;
    cursor: pointer;
    font-size: 13px;
}
.edit-btn { background: #FFA000; }
.delete-btn { background: #f44336; }
#status {
    text-align: center;
    margin-top: 10px;
    font-size: 14px;
    color: #888;
}
#loginContainer, #cmsContainer {
    transition: all 0.3s ease;
}
</style>
</head>
<body>

<!-- Login Area -->
<div class="container" id="loginContainer">
    <div class="form-container">
        <h1>CMS Login</h1>
        <input type="email" id="emailInput" placeholder="Enter email">
        <input type="password" id="passwordInput" placeholder="Enter password">
        <button id="loginBtn" onclick="login()">Login</button>
        <div id="status"></div>
    </div>
</div>

<!-- CMS Area -->
<div class="container" id="cmsContainer" style="display:none;">
    <h1>CMS - Add / Edit Location</h1>
    <div class="form-container">
        <div class="form-grid">
            <select id="monthSelect">
                <option value="">Select Month</option>
                <option>January</option><option>February</option><option>March</option><option>April</option>
                <option>May</option><option>June</option><option>July</option><option>August</option>
                <option>September</option><option>October</option><option>November</option><option>December</option>
            </select>
            <input type="date" id="shootingDateInput">
            <input type="url" id="urlInput" placeholder="Enter URL...">
            <input type="url" id="mapPinInput" placeholder="Google Map Pin URL...">
            <select id="locationSelect">
                <option value="">Select Location</option>
                <option>Hong Kong Island</option><option>Kowloon</option><option>New Territories</option>
                <option>Lantau Island</option><option>Tai Mo Shan</option>
            </select>
            <select id="typeSelect">
                <option value="">Select Type</option>
                <option value="sunset">Sunset</option>
                <option value="sunrise">Sunrise</option>
                <option value="night_view">Night View</option>
                <option value="starry_sky">Starry Sky</option>
            </select>
        </div>
        <div class="button-row">
            <button id="saveBtn" onclick="saveLocation()">Save</button>
            <button id="logoutBtn" onclick="logout()">Logout</button>
        </div>
        <div id="status"></div>
    </div>

    <h2>Locations Table</h2>
    <table id="locationsTable">
        <thead>
            <tr>
                <th>ID</th>
                <th>Month</th>
                <th>URL</th>
                <th>Shooting Date</th>
                <th>Location</th>
                <th>Type</th>
                <th>Map Pin</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyAXTlWcavjoa98iaiguoXx0MRyQ19B1Tns",
    authDomain: "myapp-test37.firebaseapp.com",
    databaseURL: "https://myapp-test37-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "myapp-test37",
    storageBucket: "myapp-test37.firebasestorage.app",
    messagingSenderId: "1012430533501",
    appId: "1:1012430533501:web:4a6be66b2c39b219149214",
    measurementId: "G-GJVS2NNGF2"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const database = firebase.database();
const locationsRef = database.ref('locations');
let editingId = null;

auth.onAuthStateChanged(user => {
    document.getElementById('loginContainer').style.display = user ? 'none' : 'block';
    document.getElementById('cmsContainer').style.display = user ? 'block' : 'none';
    if (user) loadTable();
});

function login() {
    const email = emailInput.value.trim();
    const password = passwordInput.value;
    if (!email || !password) return showStatus('Please enter email and password!', true);
    auth.signInWithEmailAndPassword(email, password)
        .then(() => showStatus('Login successful!'))
        .catch(e => showStatus('Error: ' + e.message, true));
}
function logout() {
    auth.signOut().then(() => {
        resetForm();
        showStatus('Logged out successfully!');
    });
}
function saveLocation() {
    const month = monthSelect.value, url = urlInput.value.trim(),
          date = shootingDateInput.value, loc = locationSelect.value,
          type = typeSelect.value, map = mapPinInput.value.trim();
    if (!month || !url || !date || !loc || !type || !map) return showStatus('Please fill all fields!', true);
    const data = { month, url, shooting_date: date, location: loc, type, map_pin: map };
    let ref = editingId ? locationsRef.child(editingId) : locationsRef.push();
    if (!editingId) data.id = ref.key;
    ref.set(data).then(() => {
        showStatus(editingId ? 'Updated!' : 'Added!');
        resetForm(); loadTable(); editingId = null;
    }).catch(e => showStatus('Error: ' + e.message, true));
}
function loadTable() {
    locationsRef.once('value').then(snap => {
        const tbody = document.querySelector('#locationsTable tbody');
        tbody.innerHTML = '';
        const data = snap.val();
        if (!data) return tbody.innerHTML = '<tr><td colspan="8">No data found.</td></tr>';
        for (let id in data) {
            const d = data[id];
            tbody.innerHTML += `
                <tr>
                    <td>${id}</td>
                    <td>${d.month}</td>
                    <td><a href="${d.url}" target="_blank">Link</a></td>
                    <td>${d.shooting_date}</td>
                    <td>${d.location}</td>
                    <td>${d.type}</td>
                    <td><a href="${d.map_pin}" target="_blank">Link</a></td>
                    <td>
                        <button class="action-btn edit-btn" onclick="editLocation('${id}')">Edit</button>
                        <button class="action-btn delete-btn" onclick="deleteLocation('${id}')">Delete</button>
                    </td>
                </tr>`;
        }
    });
}
function editLocation(id) {
    locationsRef.child(id).once('value').then(snap => {
        const d = snap.val();
        if (!d) return;
        monthSelect.value = d.month;
        urlInput.value = d.url;
        shootingDateInput.value = d.shooting_date;
        locationSelect.value = d.location;
        typeSelect.value = d.type;
        mapPinInput.value = d.map_pin;
        editingId = id;
        showStatus('Editing...');
    });
}
function deleteLocation(id) {
    if (!confirm('Delete this record?')) return;
    locationsRef.child(id).remove().then(() => {
        showStatus('Deleted!');
        loadTable();
    });
}
function resetForm() {
    document.querySelectorAll('input, select').forEach(el => el.value = '');
    editingId = null;
}
function showStatus(msg, err=false) {
    const s = document.getElementById('status');
    s.textContent = msg;
    s.style.color = err ? 'red' : 'green';
    setTimeout(() => s.textContent = '', 3000);
}
</script>
</body>
</html>
